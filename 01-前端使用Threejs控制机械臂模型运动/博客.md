# å‰ç«¯ä½¿ç”¨Threejsæ§åˆ¶æœºæ¢°è‡‚æ¨¡å‹è¿åŠ¨(æˆ‘åœ¨æ˜é‡‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« )

å­¦äº†Threejsæœ‰ä¸€æ®µæ—¶é—´äº†, ä½†æ˜¯éƒ½æ˜¯å¯¹ç€æ•™ç¨‹å­¦çš„,æ²¡æœ‰å®é™…çš„éœ€æ±‚åšè¿‡,æ„Ÿè§‰Threejsè¿˜æ˜¯å¾ˆè™š

æ­£å¥½,å¯èƒ½æ˜¯é¢†å¯¼çœ‹åˆ°äº†æˆ‘çš„ç„¦è™‘,è¯´åˆ°: å°ç‹å•Š,è¿™é‡Œæœ‰ä¸ªæœºæ¢°è‡‚æ¨¡å‹çš„éœ€æ±‚,ä½ æ¥å¤„ç†ä¸€ä¸‹

æˆ‘: 
![åšç¢—ç‰›è‚‰é¢ç»™ä½ åƒ](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/81d21f5c99e34ff2bd785d4342eebd03~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=349&h=334&s=141378&e=png&b=2b2624)


## åºŸè¯ä¸å¤šè¯´,å…ˆçœ‹æ•ˆæœå›¾

![æœºæ¢°è‡‚æ•ˆæœå›¾](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d7f407efe6874bce89300f24fee22876~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1202&h=973&s=366114&e=png&a=1&b=fcfcfc)

![æœºæ¢°è‡‚æ•ˆæœå›¾](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/507ad9de7bee4319b7cb67585b77b7d0~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1920&h=911&s=155859&e=png&b=7f7f7f)

# ä½¿ç”¨æŠ€æœ¯æ ˆ
> `Vue3 + Vite + Threejs + element-plus`

# æºä»£ç 

## 1. èœå•æ§åˆ¶æœºæ¢°è‡‚è§’åº¦æ¨¡å—
```js
<!--
 * @Author: wangzhiyu <w19165802736@163.com>
 * @version: 1.0.0
 * @Date: 2024-02-20 14:04:30
 * @LastEditTime: 2024-02-20 14:09:18
 * @Descripttion: èœå•æ§åˆ¶æœºæ¢°è‡‚è§’åº¦æ¨¡å—
-->
<template>
  <el-scrollbar height="100%">
    <div class="slider-block">
      <div class="slider-item">
        <p class="demonstration">å…³èŠ‚1</p>
        <span class="demonstration">ç»•yè½´æ—‹è½¬</span>
        <el-slider v-model="joint1" show-input :min="min" :max="max" :step="0.01" @input="sliderInput($event, '1', 'y')" />
      </div>
      <div class="slider-item">
        <p class="demonstration">å…³èŠ‚2</p>
        <span class="demonstration">ç»•xè½´æ—‹è½¬</span>
        <el-slider v-model="joint2" show-input :min="min" :max="max" :step="0.01" @input="sliderInput($event, '2', 'x')" />
      </div>
      <div class="slider-item">
        <p class="demonstration">å…³èŠ‚3</p>
        <span class="demonstration">ç»•xè½´æ—‹è½¬</span>
        <el-slider v-model="joint3" show-input :min="min" :max="max" :step="0.01" @input="sliderInput($event, '3', 'x')" />
      </div>

      <div class="slider-item">
        <p class="demonstration">å…³èŠ‚4</p>
        <span class="demonstration">ç»•xè½´æ—‹è½¬</span>
        <el-slider v-model="joint4" show-input :min="min" :max="max" :step="0.01" @input="sliderInput($event, '4', 'x')" />
      </div>
      <div class="slider-item">
        <p class="demonstration">å…³èŠ‚5</p>
        <span class="demonstration">ç»•yè½´æ—‹è½¬</span>
        <el-slider v-model="joint5" show-input :min="min" :max="max" :step="0.01" @input="sliderInput($event, '5', 'y')" />
      </div>

      <div class="slider-item">
        <p class="demonstration">å…³èŠ‚6</p>
        <span class="demonstration">ç»•xè½´æ—‹è½¬</span>
        <el-slider v-model="joint6" show-input :min="min" :max="max" :step="0.01" @input="sliderInput($event, '6', 'x')" />
      </div>
    </div>
  </el-scrollbar>
</template>

<script setup>
import { ref, defineEmits } from 'vue';
const joint1 = ref(0);
const joint2 = ref(0);
const joint3 = ref(0);
const joint4 = ref(0);
const joint5 = ref(0);
const joint6 = ref(0);

const min = ref(Number(-Math.PI.toFixed(2)));
const max = ref(Number(Math.PI.toFixed(2)));

const emit = defineEmits(['sliderInput']);

const sliderInput = (e, name, direction) => {
  emit('sliderInput', e, name, direction);
};
</script>
```

## 2. å±•ç¤ºæœºæ¢°è‡‚ + æ§åˆ¶æœºæ¢°è‡‚æ–¹æ³•
```js
<!--
 * @Author: wangzhiyu <w19165802736@163.com>
 * @version: 1.0.0
 * @Date: 2024-02-20 15:14:10
 * @LastEditTime: 2024-02-20 11:05:28
 * @Descripttion: èœå•æ§åˆ¶æœºæ¢°è‡‚è§’åº¦æ¨¡å—
-->
<template>
  <div>
    <el-drawer v-model="drawer" direction="ltr" size="20%">
      <el-aside>
        <Menu @sliderInput="sliderInput" />
      </el-aside>
    </el-drawer>
    <div class="btn" v-show="!drawer">
      <el-button type="primary" :icon="Operation" circle size="large" @click="drawerSwitch" />
    </div>
  </div>
</template>
<script setup>
/**
 * æ—‹è½¬ä¸­å¿ƒç‚¹
 * 2: 0.7,0.67,0
 * 3: 0.1,2.42,0
 * 4: 0.15,4.113,0
 * 5: 0.65,4.38,0
 * 6: 0.88,4.68,0
 */
import { Operation } from '@element-plus/icons-vue';
import { ref } from 'vue';
import Menu from './components/Menu/index.vue';
import * as THREE from 'three';
// æ§åˆ¶å™¨
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
// OBJæ¨¡å‹è§£æ
import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';
import { MTLLoader } from 'three/addons/loaders/MTLLoader.js';
import { onMounted } from 'vue';
// æœºæ¢°è‡‚é›¶ä»¶æ¨¡å‹æ•°ç»„
let mtlList = ['0.mtl', '1.mtl', '2.mtl', '3.mtl', '4.mtl', '5.mtl', '6.mtl'];
let objList = ['0.obj', '1.obj', '2.obj', '3.obj', '4.obj', '5.obj', '6.obj'];

// åˆ›å»ºåœºæ™¯->ç›¸æœº->æ¸²æŸ“å™¨->ç›¸æœºæ·»åŠ åˆ°åœºæ™¯ä¸­->æ¸²æŸ“å™¨æ¸²æŸ“åœºæ™¯å’Œç›¸æœº->æ¸²æŸ“å™¨æ·»åŠ åˆ°domä¸­
let scene = '';
let camera = '';
let renderer = '';
// è½¨é“æ§åˆ¶å™¨
let controls = '';
let handList = [];
let circlePosition = '';
const drawer = ref(false);
const handConfig = [
  {
    name: '2.mtl',
    rotation: {
      x: 0.7,
      y: 0.63,
      z: 0,
    },
  },
  {
    name: '3.mtl',
    rotation: {
      x: 0.1,
      y: 2.42,
      z: 0,
    },
  },
  {
    name: '4.mtl',
    rotation: {
      x: 0.15,
      y: 4.113,
      z: 0,
    },
  },
  {
    name: '5.mtl',
    rotation: {
      x: 0.65,
      y: 4.38,
      z: 0,
    },
  },
  {
    name: '6.mtl',
    rotation: {
      x: 0.88,
      y: 4.68,
      z: 0,
    },
  },
];

// è®¾ç½®å„ä¸ªå…³èŠ‚çš„è§’åº¦
function sliderInput(value, name, direction) {
  // æ‰¾åˆ°è¦è®¾ç½®çš„å…³èŠ‚
  let target = handList.find(item => item.materialLibraries.join('') === name + '.mtl');
  target.rotation[direction] = value;
}

// å¼€å…³ä¾§è¾¹æ æ§åˆ¶æ 
const drawerSwitch = () => {
  drawer.value = !drawer.value;
};

// å°†åé¢çš„å…ƒç´ æ·»åŠ åˆ°å‰é¢å…ƒç´ çš„childrenåˆ—è¡¨ä¸­,è¿™æ ·æŸä¸ªèŠ‚ç‚¹è¿åŠ¨æ—¶,èŠ‚ç‚¹çš„childrenéƒ½å¯ä»¥è·Ÿéšè¿åŠ¨
const addChildren = () => {
  // å¯¹èŠ‚ç‚¹è¿›è¡Œæ’åº,é¿å…æ·»åŠ é”™è¯¯çš„çˆ¶çº§
  handList = handList.sort((a, b) => a.materialLibraries.join('')[0] - b.materialLibraries.join('')[0]);

  // æ·»åŠ å­çº§æ¨¡å‹
  for (let i = 0; i < handList.length; i++) {
    // å½“å‰æ¨¡å‹åé¢è¿˜æœ‰å…¶ä»–æ¨¡å‹æ—¶æ‰ä¼šå…è®¸æ·»åŠ 
    if (handList[i + 1]) {
      // å½“å‰æ¨¡å‹çš„ç±»å‹ä¸ºGroupæ—¶,è¡¨ç¤ºè¿™é‡Œæˆ‘å·²ç»ä½¿ç”¨äº†ä¸€ä¸ªçˆ¶çº§å…ƒç´ æ¥åŒ…ä½æ¨¡å‹äº†,ä»¥æ­¤æ¥ä¿®æ”¹æ¨¡å‹è¿åŠ¨çš„ä¸­å¿ƒç‚¹,å¦‚æœæ²¡æœ‰åŒ…ä½,å°±è¡¨ç¤ºè¿™ä¸ªæ¨¡å‹çš„ä¸­å¿ƒç‚¹æ˜¯å¯¹çš„,ä¸éœ€è¦æ·»åŠ åˆ°Groupä¸­
      handList[i].children[0].type === 'Group' ? handList[i].children[0].add(handList[i + 1]) : handList[i].add(handList[i + 1]);
    }
  }
  console.log(handList[0], 'handList[0]');
  // å°†æœ€ç»ˆæ•´åˆçš„æ¨¡å‹æ·»åŠ åˆ°åœºæ™¯ä¸­
  scene.add(handList[0]);
};

// åˆå§‹åŒ–
function initBase() {
  scene = new THREE.Scene();
  scene.position.set(0, -2, 0);
  camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
  camera.position.set(6, 8, 6);

  // ç›¸æœºæ·»åŠ åˆ°åœºæ™¯ä¸­
  scene.add(camera);

  // antialias:å¼€å¯æŠ—é”¯é½¿  logarithmicDepthBuffer:ä½¿ç”¨å¯¹æ•°æ·±åº¦ç¼“å†²å™¨,ä¸€èˆ¬åœ¨å•ä¸ªåœºæ™¯å¤„ç†è¾ƒå¤§çš„å·®å¼‚
  renderer = new THREE.WebGLRenderer({ antialias: true, logarithmicDepthBuffer: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setClearColor('#fff');
}

// æ·»åŠ å…‰çº¿
function addLight() {
  const positions = [
    { x: 10, y: 10, z: 10 },
    { x: -10, y: 10, z: -10 },
    { x: -30, y: 10, z: 0 },
    { x: 0, y: -10, z: 0 },
  ];
  positions.forEach(pos => {
    const light = new THREE.DirectionalLight('#8fbad3', 1);
    light.position.set(pos.x, pos.y, pos.z);
    scene.add(light);
  });
}

// å¾ªç¯å¯¼å…¥æ¨¡å‹
for (let i = 0; i < mtlList.length; i++) {
  initIsland(mtlList[i], objList[i]);
}

// æ·»åŠ æœºæ¢°è‡‚æ¨¡å‹
function initIsland(mtl, obj) {
  // objè§£æå™¨
  var objLoader = new OBJLoader();
  // mtlè§£æå™¨
  var mtlLoader = new MTLLoader();

  mtlLoader.load(`./model/${mtl}`, function (materials) {
    // å°† MaterialCreator å¯¹è±¡åº”ç”¨åˆ°æè´¨æ–‡ä»¶ä¸­
    materials.preload();

    // å°†è§£æå¾—åˆ°çš„æè´¨èµ‹å€¼ç»™ objLoader å¯¹è±¡
    objLoader.setMaterials(materials);

    // åŠ è½½ OBJ æ¨¡å‹æ–‡ä»¶
    objLoader.load(`./model/${obj}`, function (obj) {
      // å¦‚æœå½“å‰æ¨¡å‹éœ€è¦è®¾ç½®çˆ¶çº§,çˆ¶çº§å°†ä¼šä¿å­˜åˆ°è¿™ä¸ªå˜é‡ä¸­,é»˜è®¤ä½ç©º
      let objNew = null;

      // è·å–æ¨¡å‹çš„åç§°
      let objName = obj.materialLibraries.join('');

      // è·å–å½“å‰æ¨¡å‹å¯¹åº”handConfigå¯¹è±¡ä¸­çš„æŸä¸ªé…ç½®å¯¹è±¡,å¦‚æœå¯¹åº”çš„è¯,å°±è¡¨ç¤ºéœ€è¦å•ç‹¬åšä¸€äº›å¤„ç†
      let objInfo = handConfig.find(item => objName === item.name);

      // åˆ¤æ–­æ˜¯å¦å¯¹åº”
      if (objInfo) {
        // åˆ›å»ºä¸€ä¸ªMesh
        objNew = new THREE.Mesh(new THREE.SphereGeometry(0, 32, 16), new THREE.MeshBasicMaterial({ color: 'rgba(0,0,0,1)' }));
        // è®¾ç½®Meshçš„ä½ç½®
        objNew.position.set(objInfo.rotation.x, objInfo.rotation.y, objInfo.rotation.z);

        // ä¸Šé¢è®¾ç½®Meshçš„ä½ç½®ä¼šç‰©ä½“çš„ä½ç½®ä¹Ÿç§»åŠ¨è¿‡å»,è¿™é‡Œå°†ç‰©ä½“çš„ä½ç½®ç§»åŠ¨å›æ¥
        obj.position.set(-objInfo.rotation.x, -objInfo.rotation.y, -objInfo.rotation.z);

        // ç»™Meshè®¾ç½®åç§°,ä¾¿äºåç»­çš„æŸ¥æ‰¾ä¸æ“ä½œ
        objNew.materialLibraries = [objInfo.name];

        // å°†æ¨¡å‹æ·»åŠ åˆ°Meshä¸­,è¿™æ ·æ¨¡å‹çš„ä¸­å¿ƒç‚¹å°±ä¼šä»¥Meshçš„åæ ‡ä¸ºä¸­å¿ƒäº†
        objNew.add(obj);

        // è°ƒç”¨å›è°ƒå‡½æ•°,ä¾¿äºæ“ä½œ
        objInfo.callback(objNew || obj);
      }

      // é›¶ä»¶æ¨¡å‹æ·»åŠ åˆ°æ•°ç»„ä¸­,ä¾¿äºåç»­çš„ä¿®æ”¹è°ƒè¯•
      handList = [...handList, objNew || obj];

      // åŠ è½½å®Œæ‰€æœ‰çš„æ¨¡å‹åè°ƒç”¨æ·»åŠ çˆ¶çº§å­çº§å‡½æ•°
      if (handList.length === objList.length) {
        // è°ƒç”¨å‡½æ•°,è®¾ç½®çˆ¶çº§å­çº§
        addChildren();
      }
    });
  });
}

// è½¨é“æ§åˆ¶å™¨
function initOrbitControls() {
  controls = new OrbitControls(camera, renderer.domElement);
  // å¼€å¯é˜»å°¼ æ›´åŠ çœŸå®
  controls.enableDamping = true;
}

// renderæ¸²æŸ“å™¨
function render() {
  // æ¸²æŸ“å™¨æ›´æ–°
  renderer.render(scene, camera);
  // æ§åˆ¶å™¨æ›´æ–°
  controls.update();
  requestAnimationFrame(render);
}

// è¾…åŠ©çº¿
function addHelpLine() {
  // const arrowHelper = new THREE.AxesHelper(5);
  // scene.add(arrowHelper);

  const gridHelper = new THREE.GridHelper(100, 20);
  scene.add(gridHelper);
}

// åˆå§‹åŒ–
initBase();
// æ·»åŠ ç¯å…‰
addLight();
// æ·»åŠ æ§åˆ¶å™¨
initOrbitControls();
// æ·»åŠ è¾…åŠ©çº¿å’Œç½‘æ ¼åœ°æ¿
addHelpLine();

onMounted(() => {
  // å°†æ¸²æŸ“å™¨æ·»åŠ åˆ°é¡µé¢ä¸­
  document.body.appendChild(renderer.domElement);
  render();
  // çª—å£å¤§å°å¤„ç†
  window.addEventListener('resize', () => {
    // æ›´æ–°ç›¸æœºå®½é«˜æ¯”
    camera.aspect = window.innerWidth / window.innerHeight;
    // æ›´æ–°ç›¸æœºçš„æŠ•å½±çŸ©é˜µ
    camera.updateProjectionMatrix();
    // æ›´æ–°æ¸²æŸ“å™¨æ¸²æŸ“çš„å°ºå¯¸å¤§å°
    renderer.setSize(window.innerWidth, window.innerHeight);
    // è®¾ç½®æ¸²æŸ“å™¨çš„åƒç´ æ¯”(window.devicePixelRatio:å½“å‰è®¾å¤‡çš„åƒç´ æ¯”)
    renderer.setPixelRatio(window.innerWidth / window.innerHeight);
  });
});
</script>

<style>
.btn {
  position: fixed;
  bottom: 5%;
  left: 50%;
  transform: translateX(-50%);
}
</style>
```

# ä»£ç è§£æ

### 1. æ­å»ºé¡¹ç›®,åˆå§‹åŒ–ä¾èµ–

##### 1. åˆ›å»ºVue3é¡¹ç›®

```js
yarn create vite
npm init vite@latest 
pnpm create vite 
```
![åˆ›å»ºVue3é¡¹ç›®](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a0bb02aa58a14c109cdfc9b873d1bac3~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=333&h=37&s=13022&e=png&b=020202)

#### 2. è¾“å…¥é¡¹ç›®åç§°

![ç„¶åè¾“å…¥é¡¹ç›®åç§°](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c14705c152aa4c889ee2f4ba4df6a3a3~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=353&h=143&s=33591&e=png&b=010101)

#### 3. ç‚¹å‡»é”®ç›˜ä¸Šä¸‹æ–¹å‘é”®åˆ°Vue,å†æŒ‰å›è½¦é€‰æ‹©vue

![ç‚¹å‡»é”®ç›˜ä¸Šä¸‹æ–¹å‘é”®åˆ°Vue,å†æŒ‰å›è½¦é€‰æ‹©vue](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/93ac8858387441bf955305b9e7a2a855~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=614&h=325&s=69649&e=png&b=000000)

#### 4. ç»§ç»­æŒ‰ç…§å¦‚ä¸Šæ–¹å¼é€‰æ‹©JavaScript

![ç»§ç»­æŒ‰ç…§å¦‚ä¸Šæ–¹å¼é€‰æ‹©JavaScript](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/901eefd4b95e49ccbbcccf31bd573c34~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=628&h=237&s=80282&e=png&b=010101)

#### 5. æ‰“å¼€é¡¹ç›®,åˆå§‹åŒ–ä¾èµ–åŒ…

æ­¤æ—¶é¡¹ç›®å·²ç»åˆ›å»ºå®Œæ¯•,å¯ä»¥é€šè¿‡cdå‘½ä»¤è¿›å…¥é¡¹ç›®æ ¹ç›®å½•åè¿›è¡Œä¾èµ–ä¸‹è½½
```js
npm install
// æˆ–
yarn
```

#### 6. ä¸‹è½½åˆå§‹ä¾èµ–ä¸ `Threejs`å’Œ`Element-Plus`ä¾èµ–

```js
// ä¸‹è½½åˆå§‹ä¾èµ–
yarn
// æˆ–
npm install

// ä¸‹è½½Threejså’ŒElement-Plusä¾èµ– 
yarn add three element-plus
// æˆ–
npm i three element-plus
```

### 2. Threejs åœºæ™¯æ­å»º

#### 1. å¯¼å‡º`Threejs`ä¸å£°æ˜åŸºç¡€å˜é‡
```js
import * as THREE from 'three';

// åˆ›å»ºåœºæ™¯->ç›¸æœº->æ¸²æŸ“å™¨->ç›¸æœºæ·»åŠ åˆ°åœºæ™¯ä¸­->æ¸²æŸ“å™¨æ¸²æŸ“åœºæ™¯å’Œç›¸æœº->æ¸²æŸ“å™¨æ·»åŠ åˆ°domä¸­

// åœºæ™¯å˜é‡
let scene = '';
// ç›¸æœºå˜é‡
let camera = '';
// æ¸²æŸ“å™¨å˜é‡
let renderer = '';
// è½¨é“æ§åˆ¶å™¨
let controls = ''
```
#### 2. åˆå§‹åŒ–Threejsåœºæ™¯
```js
// åˆå§‹åŒ–
function initBase() {
  // åˆ›å»ºåœºæ™¯
  scene = new THREE.Scene();

  // è®¾ç½®åœºæ™¯åœ¨çš„ä½ç½®
  scene.position.set(0, -2, 0);

  // åˆ›å»ºè§†å£ç›¸æœº
  camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);

  // ä¿®æ”¹ç›¸æœºè§†å›¾ä½ç½®
  camera.position.set(6, 8, 6);

  // ç›¸æœºæ·»åŠ åˆ°åœºæ™¯ä¸­
  scene.add(camera);

  // antialias:å¼€å¯æŠ—é”¯é½¿  logarithmicDepthBuffer:ä½¿ç”¨å¯¹æ•°æ·±åº¦ç¼“å†²å™¨,ä¸€èˆ¬åœ¨å•ä¸ªåœºæ™¯å¤„ç†è¾ƒå¤§çš„å·®å¼‚
  renderer = new THREE.WebGLRenderer({ antialias: true, logarithmicDepthBuffer: true });

  // è®¾ç½®æ¸²æŸ“å™¨å°ºå¯¸
  renderer.setSize(window.innerWidth, window.innerHeight);

  // è®¾ç½®æ¸²æŸ“å™¨é¢œè‰²
  renderer.setClearColor('#fff');
}
initBase()
```

#### 3. åœºæ™¯ä¸­æ·»åŠ ç¯å…‰
```js
// æ·»åŠ å…‰çº¿
function addLight() {
  const positions = [
    { x: 10, y: 10, z: 10 },
    { x: -10, y: 10, z: -10 },
    { x: -30, y: 10, z: 0 },
    { x: 0, y: -10, z: 0 },
  ];
  positions.forEach(pos => {
    const light = new THREE.DirectionalLight('#8fbad3', 1);
    light.position.set(pos.x, pos.y, pos.z);
    scene.add(light);
  });
}
addLight()
```

#### 4. æ·»åŠ è½¨é“æ§åˆ¶å™¨
```js
// è½¨é“æ§åˆ¶å™¨
function initOrbitControls() {
  // åˆ›å»ºè½¨é“æ§åˆ¶å™¨
  controls = new OrbitControls(camera, renderer.domElement);
  // å¼€å¯é˜»å°¼ æ›´åŠ çœŸå®
  controls.enableDamping = true;
}
initOrbitControls()
```

#### 5. æ·»åŠ åœºæ™¯è¾…åŠ©çº¿
```js
// æ·»åŠ è¾…åŠ©çº¿
function addHelpLine() {
  const gridHelper = new THREE.GridHelper(100, 20);
  scene.add(gridHelper);
}
addHelpLine()
```

#### 6. æ‰§è¡Œåœºæ™¯æ¸²æŸ“ä¸ç›‘å¬å°ºå¯¸å˜åŒ–è€Œä¸æ–­é€‚é…åœºæ™¯
```js
import { onMounted } from 'vue';

// renderæ¸²æŸ“å™¨
function render() {
  // æ¸²æŸ“å™¨æ›´æ–°
  renderer.render(scene, camera);
  // æ§åˆ¶å™¨æ›´æ–°
  controls.update();
  requestAnimationFrame(render);
}

onMounted(() => {
  // å°†æ¸²æŸ“å™¨æ·»åŠ åˆ°é¡µé¢ä¸­
  document.body.appendChild(renderer.domElement);
  render();
  // çª—å£å¤§å°å¤„ç†
  window.addEventListener('resize', () => {
    // æ›´æ–°ç›¸æœºå®½é«˜æ¯”
    camera.aspect = window.innerWidth / window.innerHeight;
    // æ›´æ–°ç›¸æœºçš„æŠ•å½±çŸ©é˜µ
    camera.updateProjectionMatrix();
    // æ›´æ–°æ¸²æŸ“å™¨æ¸²æŸ“çš„å°ºå¯¸å¤§å°
    renderer.setSize(window.innerWidth, window.innerHeight);
    // è®¾ç½®æ¸²æŸ“å™¨çš„åƒç´ æ¯”(window.devicePixelRatio:å½“å‰è®¾å¤‡çš„åƒç´ æ¯”)
    renderer.setPixelRatio(window.innerWidth / window.innerHeight);
  });
});
```

### 3. å¯¼å…¥æ¨¡å‹

#### 1. å¯¼å…¥Threejså¯¼å…¥æ¨¡å‹ä¸æè´¨çš„API

```js
// OBJæ¨¡å‹è§£æ
import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';
// MTLæè´¨è§£æ
import { MTLLoader } from 'three/addons/loaders/MTLLoader.js';
```

#### 2. å¯¼å…¥æ¨¡å‹å¹¶æ·»åŠ åˆ°åœºæ™¯ä¸­
```js
// æœºæ¢°è‡‚é›¶ä»¶æ¨¡å‹æ•°ç»„
let mtlList = ['0.mtl', '1.mtl', '2.mtl', '3.mtl', '4.mtl', '5.mtl', '6.mtl'];
// æœºæ¢°è‡‚é›¶ä»¶æè´¨æ•°ç»„
let objList = ['0.obj', '1.obj', '2.obj', '3.obj', '4.obj', '5.obj', '6.obj'];

// æœºæ¢°è‡‚é…ç½®æ•°ç»„(é…ç½®ä¸­çš„rotationå°±æ˜¯æ—‹è½¬çš„ä¸­å¿ƒç‚¹,æŠ€æœ¯æ°´å¹³æœ‰é™,åªèƒ½é€šè¿‡è¿™ç§æ–¹å¼æŒ‡å®šä¸­å¿ƒç‚¹,æœ‰æ²¡æœ‰å¤§ä½¬å¯ä»¥å¯ä»¥å‡ºä¸€äº›æ›´å¥½çš„ä¸­å¿ƒç‚¹è§£å†³æ–¹æ¡ˆ ps: è¯¦ç»†é—®é¢˜æ”¾åœ¨æœ€åäº†)
const handConfig = [
  {
    name: '2.mtl',
    rotation: {
      x: 0.7,
      y: 0.63,
      z: 0,
    },
  },
  {
    name: '3.mtl',
    rotation: {
      x: 0.1,
      y: 2.42,
      z: 0,
    },
  },
  {
    name: '4.mtl',
    rotation: {
      x: 0.15,
      y: 4.113,
      z: 0,
    },
  },
  {
    name: '5.mtl',
    rotation: {
      x: 0.65,
      y: 4.38,
      z: 0,
    },
  },
  {
    name: '6.mtl',
    rotation: {
      x: 0.88,
      y: 4.68,
      z: 0,
    },
  },
];

// æ·»åŠ æœºæ¢°è‡‚æ¨¡å‹
function initIsland(mtl, obj) {
  // objè§£æå™¨
  var objLoader = new OBJLoader();
  // mtlè§£æå™¨
  var mtlLoader = new MTLLoader();

  mtlLoader.load(`./model/${mtl}`, function (materials) {
    // å°† MaterialCreator å¯¹è±¡åº”ç”¨åˆ°æè´¨æ–‡ä»¶ä¸­
    materials.preload();

    // å°†è§£æå¾—åˆ°çš„æè´¨èµ‹å€¼ç»™ objLoader å¯¹è±¡
    objLoader.setMaterials(materials);

    // åŠ è½½ OBJ æ¨¡å‹æ–‡ä»¶
    objLoader.load(`./model/${obj}`, function (obj) {
      // å¦‚æœå½“å‰æ¨¡å‹éœ€è¦è®¾ç½®çˆ¶çº§,çˆ¶çº§å°†ä¼šä¿å­˜åˆ°è¿™ä¸ªå˜é‡ä¸­,é»˜è®¤ä½ç©º
      let objNew = null;

      // è·å–æ¨¡å‹çš„åç§°
      let objName = obj.materialLibraries.join('');

      // è·å–å½“å‰æ¨¡å‹å¯¹åº”handConfigå¯¹è±¡ä¸­çš„æŸä¸ªé…ç½®å¯¹è±¡,å¦‚æœå¯¹åº”çš„è¯,å°±è¡¨ç¤ºéœ€è¦å•ç‹¬åšä¸€äº›å¤„ç†
      let objInfo = handConfig.find(item => objName === item.name);

      // åˆ¤æ–­æ˜¯å¦å¯¹åº”
      if (objInfo) {
        // åˆ›å»ºä¸€ä¸ªMesh
        objNew = new THREE.Mesh(new THREE.SphereGeometry(0, 32, 16), new THREE.MeshBasicMaterial({ color: 'rgba(0,0,0,1)' }));
        // è®¾ç½®Meshçš„ä½ç½®
        objNew.position.set(objInfo.rotation.x, objInfo.rotation.y, objInfo.rotation.z);

        // ä¸Šé¢è®¾ç½®Meshçš„ä½ç½®ä¼šç‰©ä½“çš„ä½ç½®ä¹Ÿç§»åŠ¨è¿‡å»,è¿™é‡Œå°†ç‰©ä½“çš„ä½ç½®ç§»åŠ¨å›æ¥
        obj.position.set(-objInfo.rotation.x, -objInfo.rotation.y, -objInfo.rotation.z);

        // ç»™Meshè®¾ç½®åç§°,ä¾¿äºåç»­çš„æŸ¥æ‰¾ä¸æ“ä½œ
        objNew.materialLibraries = [objInfo.name];

        // å°†æ¨¡å‹æ·»åŠ åˆ°Meshä¸­,è¿™æ ·æ¨¡å‹çš„ä¸­å¿ƒç‚¹å°±ä¼šä»¥Meshçš„åæ ‡ä¸ºä¸­å¿ƒäº†
        objNew.add(obj);

        // è°ƒç”¨å›è°ƒå‡½æ•°,ä¾¿äºæ“ä½œ
        objInfo.callback(objNew || obj);
      }

      // é›¶ä»¶æ¨¡å‹æ·»åŠ åˆ°æ•°ç»„ä¸­,ä¾¿äºåç»­çš„ä¿®æ”¹è°ƒè¯•
      handList = [...handList, objNew || obj];

      // åŠ è½½å®Œæ‰€æœ‰çš„æ¨¡å‹åè°ƒç”¨æ·»åŠ çˆ¶çº§å­çº§å‡½æ•°
      if (handList.length === objList.length) {
        // è°ƒç”¨å‡½æ•°,è®¾ç½®çˆ¶çº§å­çº§
        addChildren();
      }
    });
  });
}

// å¾ªç¯å¯¼å…¥æ¨¡å‹
for (let i = 0; i < mtlList.length; i++) {
  initIsland(mtlList[i], objList[i]);
}
```

#### 3. å°†æ¨¡å‹ä¸€å±‚å±‚åµŒå¥—æ·»åŠ åˆ°ä¸Šä¸€ä¸ªæ¨¡å‹å…³èŠ‚çš„childrenä¸­,æ–¹ä¾¿æ§åˆ¶

##### ä¸ºä»€ä¹ˆè¦è¿™æ ·å¤„ç†:  è¿™æ ·å¤„ç†ä¹‹å,åŸºåº§çš„æ—‹è½¬è§’åº¦æ”¹å˜,åˆ™åŸºåº§çš„childrenå­æ¨¡å‹éƒ½ä¼šè·Ÿéšæ”¹å˜,ä¹Ÿå°±è§£å†³äº†åç»­å…³èŠ‚æ¨¡å‹ä¸ä¼šè·Ÿéšä¹‹å‰çš„å…³èŠ‚æ¨¡å‹æ‰€æ”¹å˜çš„é—®é¢˜

```js
// å°†åé¢çš„å…ƒç´ æ·»åŠ åˆ°å‰é¢å…ƒç´ çš„childrenåˆ—è¡¨ä¸­,è¿™æ ·æŸä¸ªèŠ‚ç‚¹è¿åŠ¨æ—¶,èŠ‚ç‚¹çš„childrenéƒ½å¯ä»¥è·Ÿéšè¿åŠ¨
const addChildren = () => {
  // å¯¹èŠ‚ç‚¹è¿›è¡Œæ’åº,é¿å…æ·»åŠ é”™è¯¯çš„çˆ¶çº§
  handList = handList.sort((a, b) => a.materialLibraries.join('')[0] - b.materialLibraries.join('')[0]);

  // æ·»åŠ å­çº§æ¨¡å‹
  for (let i = 0; i < handList.length; i++) {
    // å½“å‰æ¨¡å‹åé¢è¿˜æœ‰å…¶ä»–æ¨¡å‹æ—¶æ‰ä¼šå…è®¸æ·»åŠ 
    if (handList[i + 1]) {
      // å½“å‰æ¨¡å‹çš„ç±»å‹ä¸ºGroupæ—¶,è¡¨ç¤ºè¿™é‡Œæˆ‘å·²ç»ä½¿ç”¨äº†ä¸€ä¸ªçˆ¶çº§å…ƒç´ æ¥åŒ…ä½æ¨¡å‹äº†,ä»¥æ­¤æ¥ä¿®æ”¹æ¨¡å‹è¿åŠ¨çš„ä¸­å¿ƒç‚¹,å¦‚æœæ²¡æœ‰åŒ…ä½,å°±è¡¨ç¤ºè¿™ä¸ªæ¨¡å‹çš„ä¸­å¿ƒç‚¹æ˜¯å¯¹çš„,ä¸éœ€è¦æ·»åŠ åˆ°Groupä¸­
      handList[i].children[0].type === 'Group' ? handList[i].children[0].add(handList[i + 1]) : handList[i].add(handList[i + 1]);
    }
  }
  console.log(handList[0], 'handList[0]');
  // å°†æœ€ç»ˆæ•´åˆçš„æ¨¡å‹æ·»åŠ åˆ°åœºæ™¯ä¸­
  scene.add(handList[0]);
};
```

### 4. æä¾›æ§åˆ¶æœºæ¢°è‡‚è¿åŠ¨åˆ°æŒ‡å®šè§’åº¦çš„API
```js
/**
 * è®¾ç½®å„ä¸ªå…³èŠ‚çš„è§’åº¦
 * @param {number} value æŒ‡å®šçš„è§’åº¦å€¼
 * @param {string} name æ§åˆ¶çš„å…³èŠ‚åç§° 
 * @param {string} direction æ—‹è½¬æ–¹å‘ 
 */
function sliderInput(value, name, direction) {
  // æ‰¾åˆ°è¦è®¾ç½®çš„å…³èŠ‚
  let target = handList.find(item => item.materialLibraries.join('') === name + '.mtl');
  target.rotation[direction] = value;
}
```

### 5. ä¸»é¡µé¢å¸ƒå±€éƒ¨åˆ†

```js
<template>
  <div>
    <el-drawer v-model="drawer" direction="ltr" size="20%">
      <el-aside>
        <Menu @sliderInput="sliderInput" />
      </el-aside>
    </el-drawer>
    <div class="btn" v-show="!drawer">
      <el-button type="primary" :icon="Operation" circle size="large" @click="drawerSwitch" />
    </div>
  </div>
</template>
```

### 6. å­é¡µé¢Menuéƒ¨åˆ†

```js
<template>
  <el-scrollbar height="100%">
    <div class="slider-block">
      <div class="slider-item">
        <p class="demonstration">å…³èŠ‚1</p>
        <span class="demonstration">ç»•yè½´æ—‹è½¬</span>
        <el-slider v-model="joint1" show-input :min="min" :max="max" :step="0.01" @input="sliderInput($event, '1', 'y')" />
      </div>
      <div class="slider-item">
        <p class="demonstration">å…³èŠ‚2</p>
        <span class="demonstration">ç»•xè½´æ—‹è½¬</span>
        <el-slider v-model="joint2" show-input :min="min" :max="max" :step="0.01" @input="sliderInput($event, '2', 'x')" />
      </div>
      <div class="slider-item">
        <p class="demonstration">å…³èŠ‚3</p>
        <span class="demonstration">ç»•xè½´æ—‹è½¬</span>
        <el-slider v-model="joint3" show-input :min="min" :max="max" :step="0.01" @input="sliderInput($event, '3', 'x')" />
      </div>

      <div class="slider-item">
        <p class="demonstration">å…³èŠ‚4</p>
        <span class="demonstration">ç»•xè½´æ—‹è½¬</span>
        <el-slider v-model="joint4" show-input :min="min" :max="max" :step="0.01" @input="sliderInput($event, '4', 'x')" />
      </div>
      <div class="slider-item">
        <p class="demonstration">å…³èŠ‚5</p>
        <span class="demonstration">ç»•yè½´æ—‹è½¬</span>
        <el-slider v-model="joint5" show-input :min="min" :max="max" :step="0.01" @input="sliderInput($event, '5', 'y')" />
      </div>

      <div class="slider-item">
        <p class="demonstration">å…³èŠ‚6</p>
        <span class="demonstration">ç»•xè½´æ—‹è½¬</span>
        <el-slider v-model="joint6" show-input :min="min" :max="max" :step="0.01" @input="sliderInput($event, '6', 'x')" />
      </div>
    </div>
  </el-scrollbar>
</template>

<script setup>
import { ref, defineEmits } from 'vue';
const joint1 = ref(0);
const joint2 = ref(0);
const joint3 = ref(0);
const joint4 = ref(0);
const joint5 = ref(0);
const joint6 = ref(0);

const min = ref(Number(-Math.PI.toFixed(2)));
const max = ref(Number(Math.PI.toFixed(2)));

const emit = defineEmits(['sliderInput']);

const sliderInput = (e, name, direction) => {
  emit('sliderInput', e, name, direction);
};
</script>
```

PS: é—®é¢˜--> å…³äºThreejså¦‚ä½•æŒ‡å®šæ—‹è½¬ä¸­å¿ƒç‚¹ä¸ºä¸Šä¸€ä¸ªæœºæ¢°è‡‚å…³èŠ‚çš„æŒ‡å®šç‚¹ä½åŠŸèƒ½æœ‰æ²¡æœ‰å¤§ä½¬å¯ä»¥æä¾›ä¸€ä¸‹æ€è·¯æˆ–è€…è§£å†³åŠæ³•,æˆ‘çš„åŠæ³•æ¯”è¾ƒç¬¨,å°±æ˜¯åœ¨æ¯ä¸ªå…³èŠ‚å¤–é¢åŒ…äº†ä¸€å±‚ç‰©ä½“,ç„¶åæ§åˆ¶ç‰©ä½“çš„ä½ç½®åˆ°ä¸Šä¸€ä¸ªæœºæ¢°è‡‚å…³èŠ‚çš„æŒ‡å®šç‚¹,ä¹Ÿå°±æ˜¯é…ç½®æ•°ç»„ä¸­çš„rotationä¸­çš„xyzå‚æ•°,ä½†æ˜¯è¿™é‡Œçš„xyzéƒ½æ˜¯æ‰‹åŠ¨ä¸€ç‚¹ç‚¹è‚‰çœ¼çœ‹å‡ºæ¥å·®åˆ«çš„,å¸Œæœ›æœ‰å¤§ä½¬å¯ä»¥ä¼˜åŒ–ä¸€ä¸‹

è¡¥å……: æ­¤é¡¹ç›®çš„ä»»ä½•é—®é¢˜ä»¥åŠæºä»£ç å’Œæ¨¡å‹æ–‡ä»¶å¯ä»¥åŠ wxè·å–: wang3209605851  , æˆ–è€…æ˜é‡‘ç§ä¿¡ä¹Ÿå¯ä»¥ğŸ˜

## æ€»ç»“: ç»¼ä¸Šä¸Šä¸Šä¸Š....æ‰€è¿°,ä¸€ä¸ªå‰ç«¯é€šè¿‡æ§ä»¶æ§åˆ¶æœºæ¢°è‡‚è¿›è¡Œæ—‹è½¬çš„åŠŸèƒ½å°±å®Œæˆå•¦! ä¹Ÿæ˜¯æˆåŠŸçš„ç»™è€å¤§åšäº†ä¸€ç¢—ç‰›è‚‰é¢

è€å¤§: ![æˆ‘ä¸åƒç‰›è‚‰](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/baaefc788fb94b9c8e85e619da140386~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1245&h=698&s=1106990&e=png&b=271e16)