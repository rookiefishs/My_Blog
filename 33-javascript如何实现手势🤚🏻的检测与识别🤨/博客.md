<!--
 * @Author: WangZhiYu <w19165802736@163.com>
 * @Date: 2025-06-11 14:29:30
 * @LastEditTime: 2025-06-11 14:29:44
 * @LastEditors: WangZhiYu <w19165802736@163.com>
 * @Descripttion: javascriptå¦‚ä½•å®ç°æ‰‹åŠ¿ğŸ¤šğŸ»çš„æ£€æµ‹ä¸è¯†åˆ«?ğŸ¤¨
-->
# javascriptå¦‚ä½•å®ç°æ‰‹åŠ¿ğŸ¤šğŸ»çš„æ£€æµ‹ä¸è¯†åˆ«?ğŸ¤¨

## 1.å‰è¨€
- æ‰‹åŠ¿è¯†åˆ«ä¸æ£€æµ‹çš„ä»‹ç»: æ‰‹åŠ¿è¯†åˆ«ä¸æ£€æµ‹æ˜¯è®¡ç®—æœºè§†è§‰å’Œäººå·¥æ™ºèƒ½é¢†åŸŸçš„é‡è¦ç ”ç©¶æ–¹å‘,é€šè¿‡ç®—æ³•è®©è®¡ç®—æœºç†è§£äººç±»æ‰‹åŠ¿çš„å«ä¹‰,æ‰‹åŠ¿æ£€æµ‹(`Gesture Detection`)è¡¨ç¤ºå®šä½å›¾åƒä¸è§†é¢‘ä¸­æ‰‹éƒ¨çš„ä½ç½®,æ‰‹åŠ¿è¯†åˆ«(`GestureRecognition`)è¡¨ç¤ºå°†æ£€æµ‹åˆ°çš„æ‰‹åŠ¿æ°›å›´ç‰¹å®šçš„è¯­è¨€,ä¾‹å¦‚å¼ å¼€æ‰‹æŒ,æ¡æ‹³,ç‚¹èµç­‰æ‰‹åŠ¿
- å‰ç«¯å®ç°æ‰‹åŠ¿çš„æ£€æµ‹ä¸è¯†åˆ«çš„ä½œç”¨: å‰ç«¯çš„æœ¬è´¨å°±æ˜¯ç”¨æˆ·ä¸è®¡ç®—æœºçš„äº¤äº’è¡Œä¸º,æ‰‹åŠ¿çš„æ£€æµ‹ä¸è¯†åˆ«å¯ä»¥æ‹“å±•ä¼ ç»Ÿçš„ç‚¹å‡»è¡Œä¸ºäº¤äº’æ–¹å¼

## 2.å®ç°æ‰€ä½¿ç”¨çš„æŠ€æœ¯æ ˆ
- Vue3+Vite+@mediapipe
> @mediapipeæ˜¯ç”± Google å¼€å‘çš„ä¸€ä¸ªå¼€æºè·¨å¹³å°æ¡†æ¶ï¼Œä¸“ä¸ºâ€‹**â€‹å®æ—¶å¤šåª’ä½“å¤„ç†â€‹**â€‹ï¼ˆå¦‚æ‰‹åŠ¿è¯†åˆ«ã€äººè„¸æ£€æµ‹ã€å§¿æ€ä¼°è®¡ç­‰ï¼‰è®¾è®¡ï¼Œå…·æœ‰é«˜æ•ˆã€è½»é‡åŒ–å’Œå¤šç¡¬ä»¶æ”¯æŒçš„ç‰¹ç‚¹,æ‰€ä»¥å¯ä»¥ä½¿ç”¨@mediapipeæ¥åœ¨å‰ç«¯å®ç°æ‰‹åŠ¿è¯†åˆ«

## 3.æºç è®²è§£
- é™æ€é¡µé¢æ­å»º
```js
<template>
  <div id="liveView" class="videoView">
    <video id="webcam" autoplay playsinline></video>
    <canvas class="output_canvas" id="output_canvas"></canvas>
  </div>
  <div class="imgInfo">
    <p>è¯†åˆ«åˆ°çš„æ‰‹åŠ¿:{{ videoGestureInfo.categoryName }}</p>
    <p>ç›¸ä¼¼åº¦:{{ videoGestureInfo.categoryScore }}</p>
    <p>å·¦å³æ‰‹:{{ videoGestureInfo.handedness }}</p>
  </div>
</template>

<style lang="scss" scoped>
video {
  clear: both;
  display: block;
  transform: rotateY(180deg);
  -webkit-transform: rotateY(180deg);
  -moz-transform: rotateY(180deg);
  width: 100vw;
  height: 100vh;
}

.imgInfo {
  position: fixed;
  top: 0;
  left: 0;
  color: #fff;
  p {
    margin: 10px 0;
  }
}

.videoView {
  display: flex;
  justify-content: center;
  width: 100vw;
  height: 100vh;
  background-color: #000;
  #webcam {
    margin: 0 auto;
    width: 1250px;
    height: 100%;
  }
}

.canvas {
  z-index: 1;
  position: absolute;
  pointer-events: none;
}

.output_canvas {
  position: absolute;
  top: 0;
  margin: 0 auto;
  transform: rotateY(180deg);
  -webkit-transform: rotateY(180deg);
  -moz-transform: rotateY(180deg);
}

.output {
  display: none;
  width: 100%;
  font-size: calc(8px + 1.2vw);
}
</style>
```

- è¾…åŠ©æ–¹æ³•
```js
// åˆ¤æ–­æ˜¯å¦å¯ä»¥ä½¿ç”¨æ‘„åƒå¤´
function hasGetUserMedia() {
  return !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);
}
```

- åˆ›å»ºæ‰‹åŠ¿è¯†åˆ«å™¨
```js
// åˆ›å»ºæ‰‹åŠ¿è¯†åˆ«å™¨
const createGestureRecognizer = async () => {
  // åŠ è½½æŒ‡å®šç‰ˆæœ¬çš„MediaPipeè§†è§‰ä»»åŠ¡WebAssemblyæ¨¡å—
  const vision = await FilesetResolver.forVisionTasks('https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.3/wasm');

  // åˆ›å»ºäº†ä¸€ä¸ªæ‰‹åŠ¿è¯†åˆ«å™¨å®ä¾‹(è¿™ä¸ªæ‰‹åŠ¿è¯†åˆ«å™¨å®ä¾‹ä½¿ç”¨çš„æ˜¯æŒ‡å®šç‰ˆæœ¬çš„MediaPipeè§†è§‰ä»»åŠ¡WebAssemblyæ¨¡å—)
  gestureRecognizer = await GestureRecognizer.createFromOptions(vision, {
    // è¯†åˆ«å™¨é…ç½®
    baseOptions: {
      // æŒ‡å‘æ‰‹åŠ¿è¯†åˆ«æ¨¡å‹çš„è·¯å¾„
      modelAssetPath: './gesture_recognizer.task',
      // è®¾ç½®ä¸ºGPUä»¥å°è¯•åˆ©ç”¨å›¾å½¢å¤„ç†å•å…ƒè¿›è¡ŒåŠ é€Ÿ,æé«˜æ¨¡å‹æ¨ç†çš„é€Ÿåº¦
      delegate: 'GPU',
    },
    // æ£€æµ‹æ‰‹æŒçš„æ•°é‡
    numHands: 2,
  });

  console.log('æ‰‹åŠ¿è¯†åˆ«å™¨åŠ è½½å®Œæ¯•');
  // è¯†åˆ«è§†é¢‘ä¸­çš„æ‰‹åŠ¿
  predictWebcam();
};
```

- è¯†åˆ«è§†é¢‘ä¸­çš„æ‰‹åŠ¿
```js
// è¯†åˆ«è§†é¢‘ä¸­çš„æ‰‹åŠ¿
const predictWebcam = async () => {
  // åˆ¤æ–­æ˜¯å¦å¯ä»¥ä½¿ç”¨æ‘„åƒå¤´
  if (!hasGetUserMedia()) return alert('æ­¤è®¾å¤‡ä¸å…è®¸ä½¿ç”¨æ‘„åƒå¤´!');
  // åˆ¤æ–­æ‰‹åŠ¿è¯†åˆ«å™¨æ˜¯å¦åŠ è½½å®Œæˆ
  if (!gestureRecognizer) return alert('æ‰‹åŠ¿è¯†åˆ«å™¨æœªåŠ è½½å®Œæˆ');

  if (runningMode.value !== 'VIDEO') {
    // è®¾ç½®è¯†åˆ«å™¨è¯†åˆ«çš„ç±»å‹ä¸ºè§†é¢‘
    runningMode.value = 'VIDEO';
    await gestureRecognizer.setOptions({ runningMode: runningMode.value });
  }

  await gestureRecognizer.setOptions({ numHands: 2 });

  nextTick(() => {
    // è·å–videoå…ƒç´ 
    const video = document.getElementById('webcam');
    // è·å–è§†é¢‘æ‰‹åŠ¿èŠ‚ç‚¹ç»˜åˆ¶çš„canvaså…ƒç´ 
    const canvasElement = document.getElementById('output_canvas');
    // è®¾ç½®canvasçš„å®½åº¦å’Œé«˜åº¦ä¸ºvideoçš„å®½åº¦å’Œé«˜åº¦
    canvasElement.width = video.clientWidth;
    canvasElement.height = video.clientHeight;
    // è·å–canvasçš„ä¸Šä¸‹æ–‡
    const canvasCtx = canvasElement.getContext('2d');

    // è®¾ç½®ä¸Šæ¬¡è¯†åˆ«è§†é¢‘æ‰‹åŠ¿çš„æ—¶é—´
    let lastVideoTime = -1;

    // è¯†åˆ«è§†é¢‘ä¸­çš„æ‰‹åŠ¿
    const predictWebcam = () => {
      // è·å–å½“å‰è§†é¢‘çš„æ—¶é—´
      let nowInMs = Date.now();
      let results = {};

      // å¦‚æœè§†é¢‘çš„æ—¶é—´å‘ç”Ÿå˜åŒ–,åˆ™è¯†åˆ«è§†é¢‘ä¸­çš„æ‰‹åŠ¿
      if (video.currentTime !== lastVideoTime) {
        // æ›¿æ¢ä¸Šæ¬¡è¯†åˆ«è§†é¢‘æ‰‹åŠ¿çš„æ—¶é—´
        lastVideoTime = video.currentTime;
        results = gestureRecognizer.recognizeForVideo(video, nowInMs);
      }

      // ä¿å­˜å½“å‰çš„canvasçŠ¶æ€
      canvasCtx.save();
      // æ¸…é™¤canvasçš„å†…å®¹
      canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);

      // åˆ›å»ºdrawingUtilså®ä¾‹,ç”¨äºå¯è§†åŒ–MediaPipeVisionä»»åŠ¡çš„ç»“æœ
      const drawingUtils = new DrawingUtils(canvasCtx);
      // åˆ¤æ–­æ˜¯å¦è¯†åˆ«åˆ°æ‰‹åŠ¿
      if (results.landmarks) {
        // å¾ªç¯ç»˜åˆ¶æ‰‹åŠ¿çš„èŠ‚ç‚¹
        for (const landmarks of results.landmarks) {
          // ç»˜åˆ¶æ‰‹åŠ¿è¿æ¥çº¿
          drawingUtils.drawConnectors(landmarks, GestureRecognizer.HAND_CONNECTIONS, {
            // è¿æ¥çº¿çš„é¢œè‰²
            color: '#00FF00',
            // è¿æ¥çº¿çš„å®½åº¦
            lineWidth: 3,
          });
          // ç»˜åˆ¶æ‰‹åŠ¿å…³èŠ‚ç‚¹
          drawingUtils.drawLandmarks(landmarks, {
            // å…³èŠ‚ç‚¹çš„é¢œè‰²
            color: '#FF0000',
            // å…³èŠ‚ç‚¹çš„åŠå¾„
            radius: 2.5,
          });
        }
      }
      // æ¢å¤canvasçš„çŠ¶æ€
      canvasCtx.restore();

      // åˆ¤æ–­æ˜¯å¦è¯†åˆ«åˆ°æ‰‹åŠ¿æ•°æ®
      if (results?.gestures?.length > 0) {
        videoGestureInfo.value.categoryName = enumGesture[results.gestures[0][0].categoryName];
        videoGestureInfo.value.categoryScore = parseFloat(results.gestures[0][0].score * 100).toFixed(2);
        videoGestureInfo.value.handedness = results.handednesses[0][0].displayName;
      } else {
        videoGestureInfo.value.categoryName = '';
        videoGestureInfo.value.categoryScore = '';
        videoGestureInfo.value.handedness = '';
      }

      // é€’å½’è°ƒç”¨,ç»§ç»­è¯†åˆ«è§†é¢‘ä¸­çš„æ‰‹åŠ¿
      requestAnimationFrame(predictWebcam);
    };

    // æ‰“å¼€æ‘„åƒå¤´
    navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
      // è§†é¢‘æµæ·»åŠ åˆ°videoå…ƒç´ ä¸­
      video.srcObject = stream;
      // ç»‘å®šè§†é¢‘åŠ è½½å®Œæˆäº‹ä»¶,å¼€å§‹è¯†åˆ«è§†é¢‘ä¸­çš„æ‰‹åŠ¿
      video.addEventListener('loadeddata', predictWebcam);
    });
  });
};
```

- æ•´ä½“jsä»£ç 
```js
import { GestureRecognizer, FilesetResolver, DrawingUtils } from './tasks-version@0.10.3.js';

// æ‰‹åŠ¿è¯†åˆ«å™¨å®ä¾‹
let gestureRecognizer;

// è¯†åˆ«å™¨è¯†åˆ«çš„ç±»å‹(å›¾ç‰‡/è§†é¢‘)
const runningMode = ref();

// è§†é¢‘æ‰‹åŠ¿ä¿¡æ¯
const videoGestureInfo = ref({});

// æ‰‹åŠ¿æšä¸¾
const enumGesture = {
  Closed_Fist: 'æ¡ç´§æ‹³å¤´',
  Open_Palm: 'å¼ å¼€æ‰‹æŒ',
  Thumb_Up: 'ç«–èµ·å¤§æ‹‡æŒ‡',
  Thumb_Down: 'æ‹‡æŒ‡æœä¸‹',
  Pointing_Up: 'æŒ‡å‘ä¸Š',
  Victory: 'èƒœåˆ©',
  None: 'æœªè¯†åˆ«',
};

// åˆ›å»ºæ‰‹åŠ¿è¯†åˆ«å™¨
const createGestureRecognizer = async () => {
  // åŠ è½½æŒ‡å®šç‰ˆæœ¬çš„MediaPipeè§†è§‰ä»»åŠ¡WebAssemblyæ¨¡å—
  const vision = await FilesetResolver.forVisionTasks('https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.3/wasm');

  // åˆ›å»ºäº†ä¸€ä¸ªæ‰‹åŠ¿è¯†åˆ«å™¨å®ä¾‹(è¿™ä¸ªæ‰‹åŠ¿è¯†åˆ«å™¨å®ä¾‹ä½¿ç”¨çš„æ˜¯æŒ‡å®šç‰ˆæœ¬çš„MediaPipeè§†è§‰ä»»åŠ¡WebAssemblyæ¨¡å—)
  gestureRecognizer = await GestureRecognizer.createFromOptions(vision, {
    // è¯†åˆ«å™¨é…ç½®
    baseOptions: {
      // æŒ‡å‘æ‰‹åŠ¿è¯†åˆ«æ¨¡å‹çš„è·¯å¾„
      modelAssetPath: './gesture_recognizer.task',
      // è®¾ç½®ä¸ºGPUä»¥å°è¯•åˆ©ç”¨å›¾å½¢å¤„ç†å•å…ƒè¿›è¡ŒåŠ é€Ÿ,æé«˜æ¨¡å‹æ¨ç†çš„é€Ÿåº¦
      delegate: 'GPU',
    },
    // æ£€æµ‹æ‰‹æŒçš„æ•°é‡
    numHands: 2,
  });

  console.log('æ‰‹åŠ¿è¯†åˆ«å™¨åŠ è½½å®Œæ¯•');
  // è¯†åˆ«è§†é¢‘ä¸­çš„æ‰‹åŠ¿
  predictWebcam();
};

// è¯†åˆ«è§†é¢‘ä¸­çš„æ‰‹åŠ¿
const predictWebcam = async () => {
  // åˆ¤æ–­æ˜¯å¦å¯ä»¥ä½¿ç”¨æ‘„åƒå¤´
  if (!hasGetUserMedia()) return alert('æ­¤è®¾å¤‡ä¸å…è®¸ä½¿ç”¨æ‘„åƒå¤´!');
  // åˆ¤æ–­æ‰‹åŠ¿è¯†åˆ«å™¨æ˜¯å¦åŠ è½½å®Œæˆ
  if (!gestureRecognizer) return alert('æ‰‹åŠ¿è¯†åˆ«å™¨æœªåŠ è½½å®Œæˆ');

  if (runningMode.value !== 'VIDEO') {
    // è®¾ç½®è¯†åˆ«å™¨è¯†åˆ«çš„ç±»å‹ä¸ºè§†é¢‘
    runningMode.value = 'VIDEO';
    await gestureRecognizer.setOptions({ runningMode: runningMode.value });
  }

  await gestureRecognizer.setOptions({ numHands: 2 });

  nextTick(() => {
    // è·å–videoå…ƒç´ 
    const video = document.getElementById('webcam');
    // è·å–è§†é¢‘æ‰‹åŠ¿èŠ‚ç‚¹ç»˜åˆ¶çš„canvaså…ƒç´ 
    const canvasElement = document.getElementById('output_canvas');
    // è®¾ç½®canvasçš„å®½åº¦å’Œé«˜åº¦ä¸ºvideoçš„å®½åº¦å’Œé«˜åº¦
    canvasElement.width = video.clientWidth;
    canvasElement.height = video.clientHeight;
    // è·å–canvasçš„ä¸Šä¸‹æ–‡
    const canvasCtx = canvasElement.getContext('2d');

    // è®¾ç½®ä¸Šæ¬¡è¯†åˆ«è§†é¢‘æ‰‹åŠ¿çš„æ—¶é—´
    let lastVideoTime = -1;

    // è¯†åˆ«è§†é¢‘ä¸­çš„æ‰‹åŠ¿
    const predictWebcam = () => {
      // è·å–å½“å‰è§†é¢‘çš„æ—¶é—´
      let nowInMs = Date.now();
      let results = {};

      // å¦‚æœè§†é¢‘çš„æ—¶é—´å‘ç”Ÿå˜åŒ–,åˆ™è¯†åˆ«è§†é¢‘ä¸­çš„æ‰‹åŠ¿
      if (video.currentTime !== lastVideoTime) {
        // æ›¿æ¢ä¸Šæ¬¡è¯†åˆ«è§†é¢‘æ‰‹åŠ¿çš„æ—¶é—´
        lastVideoTime = video.currentTime;
        results = gestureRecognizer.recognizeForVideo(video, nowInMs);
      }

      // ä¿å­˜å½“å‰çš„canvasçŠ¶æ€
      canvasCtx.save();
      // æ¸…é™¤canvasçš„å†…å®¹
      canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);

      // åˆ›å»ºdrawingUtilså®ä¾‹,ç”¨äºå¯è§†åŒ–MediaPipeVisionä»»åŠ¡çš„ç»“æœ
      const drawingUtils = new DrawingUtils(canvasCtx);
      // åˆ¤æ–­æ˜¯å¦è¯†åˆ«åˆ°æ‰‹åŠ¿
      if (results.landmarks) {
        // å¾ªç¯ç»˜åˆ¶æ‰‹åŠ¿çš„èŠ‚ç‚¹
        for (const landmarks of results.landmarks) {
          // ç»˜åˆ¶æ‰‹åŠ¿è¿æ¥çº¿
          drawingUtils.drawConnectors(landmarks, GestureRecognizer.HAND_CONNECTIONS, {
            // è¿æ¥çº¿çš„é¢œè‰²
            color: '#00FF00',
            // è¿æ¥çº¿çš„å®½åº¦
            lineWidth: 3,
          });
          // ç»˜åˆ¶æ‰‹åŠ¿å…³èŠ‚ç‚¹
          drawingUtils.drawLandmarks(landmarks, {
            // å…³èŠ‚ç‚¹çš„é¢œè‰²
            color: '#FF0000',
            // å…³èŠ‚ç‚¹çš„åŠå¾„
            radius: 2.5,
          });
        }
      }
      // æ¢å¤canvasçš„çŠ¶æ€
      canvasCtx.restore();

      // åˆ¤æ–­æ˜¯å¦è¯†åˆ«åˆ°æ‰‹åŠ¿æ•°æ®
      if (results?.gestures?.length > 0) {
        videoGestureInfo.value.categoryName = enumGesture[results.gestures[0][0].categoryName];
        videoGestureInfo.value.categoryScore = parseFloat(results.gestures[0][0].score * 100).toFixed(2);
        videoGestureInfo.value.handedness = results.handednesses[0][0].displayName;
      } else {
        videoGestureInfo.value.categoryName = '';
        videoGestureInfo.value.categoryScore = '';
        videoGestureInfo.value.handedness = '';
      }

      // é€’å½’è°ƒç”¨,ç»§ç»­è¯†åˆ«è§†é¢‘ä¸­çš„æ‰‹åŠ¿
      requestAnimationFrame(predictWebcam);
    };

    // æ‰“å¼€æ‘„åƒå¤´
    navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
      // è§†é¢‘æµæ·»åŠ åˆ°videoå…ƒç´ ä¸­
      video.srcObject = stream;
      // ç»‘å®šè§†é¢‘åŠ è½½å®Œæˆäº‹ä»¶,å¼€å§‹è¯†åˆ«è§†é¢‘ä¸­çš„æ‰‹åŠ¿
      video.addEventListener('loadeddata', predictWebcam);
    });
  });
};

// åˆ¤æ–­æ˜¯å¦å¯ä»¥ä½¿ç”¨æ‘„åƒå¤´
function hasGetUserMedia() {
  return !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);
}

onMounted(() => {
  // åŠ è½½æ‰‹åŠ¿è¯†åˆ«å™¨
  createGestureRecognizer();
});
```

## 4.æ•ˆæœå›¾å±•ç¤º
![æ•ˆæœå›¾å±•ç¤º](https://i-blog.csdnimg.cn/direct/d2a1e92cc9e54e90ae1ae797d66af93c.png)


## 5.æ€»ç»“
æœ¬æ–‡ç®€å•ä»‹ç»äº†æ‰‹åŠ¿æ£€æµ‹ä¸è¯†åˆ«çš„æ¦‚å¿µ,ä»¥åŠå¦‚ä½•åœ¨å‰ç«¯ä¸­å®ç°æ‰‹åŠ¿çš„è¯†åˆ«ä¸æ£€æµ‹,å¤§è‡´æµç¨‹å°±æ˜¯é€šè¿‡`Google`çš„`@mediapipe`å¼€æºæ¡†æ¶å®ç°,å…ˆåˆ›å»ºæ‰‹åŠ¿è¯†åˆ«å™¨,ä¹‹åå†å°†è§†é¢‘çš„å›¾åƒä¼ å…¥è¯†åˆ«å™¨,å¾—åˆ°è¯†åˆ«çš„ç»“æœå³å¯