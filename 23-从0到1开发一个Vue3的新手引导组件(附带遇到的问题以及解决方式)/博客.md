# ä»0åˆ°1å¼€å‘ä¸€ä¸ªVue3çš„æ–°æ‰‹å¼•å¯¼ç»„ä»¶(é™„å¸¦é‡åˆ°çš„é—®é¢˜ä»¥åŠè§£å†³æ–¹å¼)

## 1. å‰è¨€:
æ–°æ‰‹å¼•å¯¼ç»„ä»¶,é¡¾åæ€ä¹‰,å°±æ˜¯å¼ºåˆ¶æ€§çš„è¦æ±‚ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„ç”¨æˆ·è·Ÿéšå¼•å¯¼ä½¿ç”¨åº”ç”¨,å¯ä»¥è®©ä¸€äº›ç¬¬ä¸€æ¬¡ä½¿ç”¨ç³»ç»Ÿçš„æ–°æ‰‹å¿«é€Ÿä¸Šæ‰‹,æ­£å¥½æˆ‘æœ€è¿‘ä¹Ÿé‡åˆ°äº†è¿™ä¸ªéœ€æ±‚,äºæ˜¯å°±æƒ³ç€å¼€å‘ä¸€ä¸ªé€šç”¨ç»„ä»¶æ‹¿å‡ºæ¥ä½¿ç”¨(å†™å®Œä¹‹åæ‰å‘ç°elementå°±æœ‰,åæ‚”äº†å“ˆå“ˆå“ˆğŸ˜­ğŸ˜­)

ç¤ºä¾‹å›¾:
1. ç¬¬ä¸€æ­¥
![ç¬¬ä¸€æ­¥](https://i-blog.csdnimg.cn/direct/eaec55d37ff341d19ea9406c83e2933a.png)

2. ç¬¬äºŒæ­¥
![ç¬¬äºŒæ­¥](https://i-blog.csdnimg.cn/direct/67d206d2518547ebbe3d6f404094b468.png)

3. ç¬¬ä¸‰æ­¥
![ç¬¬ä¸‰æ­¥](https://i-blog.csdnimg.cn/direct/7189c3e71b1f44cb8359e38269687a67.png)
## 2. ä½¿ç”¨çš„æŠ€æœ¯æ ˆä»¥åŠç»„ä»¶:
`Vue3+Vite+Element+uuid`,ä½¿ç”¨äº†`el-popover`ç»„ä»¶ä»¥åŠ`el-buttonç»„ä»¶`

## 3. é‡åˆ°çš„é—®é¢˜:
å¼€å‘è¿™ä¸ªç»„ä»¶ä¸æ˜¯ä¸€ä¸ªç®€å•çš„äº‹æƒ…,é‡åˆ°äº†ä¸å°‘çš„é—®é¢˜,å°¤å…¶æ˜¯æ ·å¼ä¸Šçš„é—®é¢˜,ä¸‹é¢æˆ‘ä¸€ä¸€è¯´æ˜ä»¥åŠå¯¹åº”çš„è§£å†³æ–¹å¼

1. éœ€è¦å°†ç”¨æˆ·å¯ä»¥ç‚¹å‡»çš„éƒ¨åˆ†å‡¸å‡ºå‡ºæ¥:

    åœ¨åŸå…ˆæˆ‘æ˜¯æ‰“ç®—ç»™ç»„ä»¶ä¼ å…¥ä¸€ä¸ª`classç±»åçš„`,ç„¶åé€šè¿‡æŒ‡å®šçš„`classç±»å`è·å–åˆ°`dom`,ä¹‹åå†é€šè¿‡`dom.getBoundingclientRect()`æ–¹æ³•è·å–æŒ‡å®šdomçš„å°ºå¯¸ä»¥åŠä½ç½®ä¿¡æ¯,ç„¶åå†ç»„ä»¶ä¸­åˆ›å»ºä¸€ä¸ªç©ºç™½åŒºåŸŸ,ä½†æ˜¯æˆ‘çœŸæ­£å°è¯•çš„æ—¶å€™æ‰å‘ç°ä¸€ä¸ªè‡´å‘½é—®é¢˜,`getBoundingclientRect`æ–¹æ³•è·å–çš„ä½ç½®ä¿¡æ¯éƒ½æ˜¯å¯¹çš„,ä½†æ˜¯å°ºå¯¸å´æ˜¯å›ºå®šçš„0,åé¢æ‰å‘ç°,å¦‚æœæ–°æ‰‹å¼•å¯¼çš„å†…å®¹æ˜¯ä¸€ä¸ªå›¾ç‰‡çš„è¯,å°±å¿…é¡»è¦ç­‰åˆ°å›¾ç‰‡åŠ è½½å®Œæˆåå†åœ¨é¡µé¢ä¸Šè¿›è¡Œå¼•å¯¼,æˆ‘å°è¯•äº†onloadä¹‹åå†è¿›è¡Œç»˜åˆ¶,è™½ç„¶å®ç°äº†æƒ³è¦çš„æ•ˆæœ,ä½†æ˜¯æˆ‘è§‰å¾—è¿™æ ·æ“ä½œå¤ªéº»çƒ¦äº†,å°±æŠ›å¼ƒäº†è¿™ç§æ–¹æ³•
    
2. æ”¹ä¸ºæ’æ§½: 

    ä¸Šé¢çš„æ–¹æ³•è¡Œä¸é€š,æ“ä½œä¹Ÿéº»çƒ¦,ç„¶åæˆ‘å°±åˆ›å»ºäº†ä¸¤ä¸ªæ’æ§½,ä¸€ä¸ªæ˜¯contentæ’æ§½,æ­¤æ’æ§½æ²¡æœ‰ä»»ä½•ä½œç”¨,åªæ˜¯å°†å†…å®¹æ˜¾ç¤ºå‡ºæ¥,ä¸€ä¸ªæ˜¯targetæ’æ§½,è¿™é‡Œçš„æ’æ§½å°†ä¼šä½œä¸ºæ–°æ‰‹å¼•å¯¼çš„å†…å®¹,è¿™é‡Œè§£é‡Šä¸‹ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªæ’æ§½,å› ä¸ºæ–°æ‰‹å¼•å¯¼ç»„ä»¶å¯èƒ½åº”ç”¨äºå¾ªç¯ä¸­,é’ˆå¯¹äºå¾ªç¯çš„å…¶ä»–å†…å®¹,å¯ä»¥ä½¿ç”¨contentæ’æ§½å¡«å……,éœ€è¦æ–°æ‰‹å¼•å¯¼çš„å†…å®¹å†ä½¿ç”¨targetæ’æ§½å³å¯

## 4. æºç è®²è§£(è¯·æŸ¥çœ‹è¯¦ç»†æ³¨é‡Š):
```html
<!--
 * @Author: wangZhiyu <w3209605851@163.com>
 * @Date: 2024-07-05 09:28:39
 * @LastEditTime: 2024-07-11 14:05:36
 * @LastEditors: wangZhiyu <w3209605851@163.com>
 * @Descripttion: /æ–°æ‰‹å¼•å¯¼ç»„ä»¶.vue
-->
<template>
  <!-- æ–°æ‰‹å¼•å¯¼æ’æ§½ -->
  <div class="targetSlot" v-if="isTarget">
    <!-- æç¤ºæ–‡å­—åŒºåŸŸ -->
    <el-popover :popper-style="`width:auto;color:#000;font-size:20px;z-index:${forceShowPopover ? 9999 : 2024}`" :visible="visible" placement="top" :offset="25">
      <!-- popoverå†…çš„å…ƒç´  -->
      <div style="white-space: nowrap; display: flex; align-items: center; justify-content: center">
        <el-button v-if="isShowAudioCourse" type="info" circle size="small" style="font-size: 18px">?</el-button>
        <span style="margin: 0 5px">{{ tipMessage }}</span>
        <el-button v-if="readBtn" type="primary" @click="onRead">{{ readMessage }}</el-button>
      </div>

      <!-- è§¦å‘popoverçš„å…ƒç´  -->
      <template #reference>
        <!-- å…ƒç´ èƒŒæ™¯é«˜äº®åŒºåŸŸ -->
        <div :class="`highLightArea highLightArea_${uuid}`" v-if="isFoucsArea"></div>
      </template>
    </el-popover>
    <slot name="target"></slot>
  </div>
  <!-- <slot name="target"></slot> -->

  <!-- æ™®é€šå†…å®¹æ’æ§½(æ ¹æ®ä¼ å…¥çš„å‚æ•°è¿›è¡ŒåŠ¨æ€æ”¹å˜) -->
  <slot :name="isTarget ? 'content' : 'target'"></slot>

  <!-- æ–°æ‰‹å¼•å¯¼é®ç½©å±‚(è¿™é‡Œç»™é®ç½©å±‚æ·»åŠ äº†ä¸€ä¸ªç‚¹å‡»äº‹ä»¶,å¹¶ä¸”ç»„ç»‡äº‹ä»¶å†’æ³¡,æ˜¯ä¸ºäº†é¿å…ç‚¹å‡»é®ç½©å±‚æ‰€äº§ç”Ÿäº‹ä»¶å†’æ³¡ç½©å±‚å½±å“) -->
  <div class="maskArea" @click.stop="() => {}" v-if="isFoucsArea && value"></div>
</template>

<script setup>
// å¯¼å…¥UUIDåº“
import { v4 as uuidv4 } from 'uuid';

import { ref, nextTick, onMounted, useSlots, watch } from 'vue';

// è®¾ç½®æ˜¯å¦æ˜¾ç¤ºæç¤ºä¿¡æ¯
const visible = ref(false);

// ç”Ÿæˆä¸€ä¸ªuuid
const uuid = uuidv4();

// æŠ›å‡ºäº‹ä»¶
const emits = defineEmits(['onRead']);

// çˆ¶ç»„ä»¶ä¼ å…¥çš„å‚æ•°
const props = defineProps({
  // æ˜¯å¦ç»§æ‰¿çˆ¶ç»„ä»¶æ ·å¼
  isInheritStyle: {
    type: Boolean,
    default: () => false,
  },
  // é«˜äº®åŒºåŸŸç›’å­çš„å æ¯”å¤§å°-->å®½
  highLightAreaWidth: {
    type: [String, Number],
  },
  // é«˜äº®åŒºåŸŸç›’å­çš„å æ¯”å¤§å°-->é«˜
  highLightAreaHeight: {
    type: [String, Number],
  },
  // é«˜äº®åŒºåŸŸç›’å­çš„å æ¯”ä½ç½®-->å‚ç›´è·ç¦»è°ƒæ•´
  highLightAreaTop: {
    type: [String, Number],
  },
  // é«˜äº®åŒºåŸŸç›’å­çš„å æ¯”ä½ç½®-->æ°´å¹³è·ç¦»è°ƒæ•´
  highLightAreaLeft: {
    type: [String, Number],
  },
  // æ˜¯å¦å¼ºåˆ¶æ˜¾ç¤ºæç¤º(é¿å…æç¤ºè¢«é®ä½çš„æƒ…å†µ)
  forceShowPopover: {
    type: Boolean,
    default: () => false,
  },
  // æ˜¯å¦æ˜¾ç¤ºå·²é˜…è¯»æŒ‰é’®
  readBtn: {
    type: Boolean,
    default: () => false,
  },
  // å†…éƒ¨æŒ‰é’®æ–‡å­—
  readMessage: {
    type: String,
    default: () => 'ä¸‹ä¸€æ­¥',
  },
  // æç¤ºæ–‡å­—
  tipMessage: {
    type: String,
    default: () => '',
  },
  // æ˜¯å¦æ˜¾ç¤ºæç¤ºæŒ‰é’®,ç‚¹å‡»åå¯æ˜¾ç¤ºå¯¹åº”çš„è§†é¢‘æ•™ç¨‹
  isShowAudioCourse: {
    type: Boolean,
    default: () => false,
  },
  // æ˜¯å¦ä¸ºå½“å‰åº”è¯¥æ˜¾ç¤ºçš„æ•™ç¨‹æ­¥éª¤(ç”¨äºä¸€ä¸ªé¡µé¢å¤šä¸ªæ­¥éª¤çš„æµç¨‹å¼•å¯¼)
  isTarget: {
    type: Boolean,
    default: () => true,
  },
  // æ˜¯å¦ä¸ºå½“å‰åº”è¯¥æ˜¾ç¤ºçš„æ•™ç¨‹æ­¥éª¤(ç”¨äºä¸€ä¸ªé¡µé¢å¤šä¸ªæ­¥éª¤çš„æµç¨‹å¼•å¯¼)
  value: {
    type: Boolean,
    default: () => true,
  },
});

// å½“å‰ç»„ä»¶ä¸­è¢«ä½¿ç”¨çš„æ’æ§½
const slot = useSlots();

// å·²å®Œæˆå¼•å¯¼
const onRead = () => {
  visible.value = false;
  emits('onRead');
};

// æ˜¯å¦èšç„¦æŒ‰é’®,é«˜äº®æ–°æ‰‹å¼•å¯¼
let isFoucsArea = ref(false);

// å¦‚æœ slot.target æˆç«‹,åˆ™è¡¨ç¤ºä½¿ç”¨äº†æ–°æ‰‹å¼•å¯¼æ’æ§½
isFoucsArea.value = slot.target ? true : false;

// é¡µé¢åˆå§‹åŒ–å‡½æ•°
const init = () => {
  nextTick(() => {
    // åˆ¤æ–­æ˜¯å¦æŒ‡å®šäº†æ–°æ‰‹å¼•å¯¼æ’æ§½çš„é«˜å±‚çº§ç›’å­ç»§æ‰¿çˆ¶å…ƒç´ çš„å…¨éƒ¨csså±æ€§(æœ€å°ç¨‹åº¦çš„å½±å“æ·»åŠ ä¸€ä¸ªdivå¸ƒå±€çš„å½±å“)
    if (props.isInheritStyle) {
      // è·å–æ–°æ‰‹å¼•å¯¼æ’æ§½çš„é«˜å±‚çº§ç›’å­
      const targetSlot = document.querySelector('.targetSlot');
      targetSlot.className = 'inheritFather';
    }

    // è·å–é«˜äº®ç›’å­
    const highLightArea = document.querySelector(`.highLightArea_${uuid}`);
    // åˆ¤æ–­é«˜äº®ç›’å­æ˜¯å¦å­˜åœ¨
    if (highLightArea) {
      // æ ¹æ®æŒ‡å®šå‚æ•°é…ç½®ç›’å­çš„é«˜äº®åŒºåŸŸå°ºå¯¸
      highLightArea.style.width = `${props.highLightAreaWidth || 100}%`;
      highLightArea.style.height = `${props.highLightAreaHeight || 100}%`;
      highLightArea.style.top = `${props.highLightAreaTop || 50}%`;
      highLightArea.style.left = `${props.highLightAreaLeft || 50}%`;
    }
    // TODO:å°†æ˜¾ç¤ºæç¤ºæ”¾åœ¨setTimeoutä¸­,å­˜å…¥å®ä»»åŠ¡é˜Ÿåˆ—,é¿å…é¡ºåºæ‰§è¡Œé”™è¯¯,åº”è¯¥ç­‰åˆ°highLightAreaç›’å­å…¨éƒ¨å¤„ç†å®Œæˆåå†æ˜¾ç¤ºæç¤ºåŒºåŸŸ,å¦åˆ™æœ‰å¯èƒ½æ˜¾ç¤ºçš„ä½ç½®ä¸å¯¹,è¿™é‡Œè®¾ç½®æ˜¯å¦æ˜¾ç¤ºæç¤ºä¿¡æ¯è¡¨ç¤ºä¸ºisFoucsArea.value,è¡¨ç¤ºåªç»™è®¾ç½®äº†æ–°æ‰‹å¼•å¯¼æ’æ§½ä¸­æ·»åŠ æç¤º,å…¶ä½™ç›’å­ä¸æ·»åŠ æç¤º
    setTimeout(() => (visible.value = isFoucsArea.value), 100);
  });
};

watch(
  () => props.isTarget,
  () => {
    setTimeout(() => {
      visible.value = true;
    }, 1);
  }
);

onMounted(init);
</script>

<style>
.maskArea {
  position: fixed;
  top: 0px;
  left: 0px;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.4);
  z-index: 1;
  cursor: default;
}
.handGif {
  position: absolute;
  left: 100%;
  width: 60px;
  height: 70px;
  transform: translateX(50%);
}

.targetSlot {
  position: relative;
  z-index: 10;
  display: flex;
  justify-content: center;
  align-items: center;
}

.inheritFather {
  all: inherit;
  z-index: 10;
}
.highLightArea {
  position: absolute;
  width: 100%;
  height: 100%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  border: 3px solid #fff;
  border-radius: 5px;
  z-index: 9;
  font-size: 16px;
  pointer-events: none;
  padding: 10px;
}
</style>
```

## 5. ä½¿ç”¨æ–°æ‰‹å¼•å¯¼ç»„ä»¶ç¤ºä¾‹:
```html
<!--
 * @Author: wangZhiyu <w3209605851@163.com>
 * @Date: 2024-07-09 13:44:13
 * @LastEditTime: 2024-07-09 15:49:38
 * @LastEditors: wangZhiyu <w3209605851@163.com>
 * @FilePath: \Vue3æ–°æ‰‹å¼•å¯¼ç»„ä»¶\Vue3-Tour\src\App.vue
 * @Descripttion: 
-->
<template>
  <div class="container">
    <w-tour @onRead="onRead" readBtn tipMessage="è¿™æ˜¯æ–°æ‰‹æ•™ç¨‹çš„ç¬¬ä¸€æ­¥" :isTarget="step === 1" :value="open">
      <template #target>
        <el-button type="primary">æŒ‰é’®1</el-button>
      </template>
    </w-tour>

    <w-tour @onRead="onRead" readBtn tipMessage="è¿™æ˜¯æ–°æ‰‹æ•™ç¨‹çš„ç¬¬äºŒæ­¥" :isTarget="step === 2" :value="open">
      <template #target>
        <el-button type="primary">æŒ‰é’®2</el-button>
      </template>
    </w-tour>

    <w-tour @onRead="onRead" readBtn tipMessage="è¿™æ˜¯æ–°æ‰‹æ•™ç¨‹çš„ç¬¬ä¸‰æ­¥" :isTarget="step === 3" :value="open">
      <template #target>
        <el-button type="primary">æŒ‰é’®3</el-button>
      </template>
    </w-tour>
  </div>
</template>
<script setup>
import { ref } from 'vue';
const step = ref(1);
const open = ref(true);

const onRead = () => {
  step.value++;

  if (step.value === 4) {
    // step.value = 0;
    open.value = false;
  }
  console.log(step.value);
};
</script>

<style scoped>
.container {
  display: flex;
  justify-content: space-around;
  align-items: center;
  width: 500px;
  height: 100px;
  background-color: #7c7777;
  margin: 100px auto;
  padding: 10px;
}
</style>
```

### 6. æ€»ç»“:
ä»¥ä¸Šå°±æ˜¯ä»0åˆ°1å¼€å‘ä¸€ä¸ªèƒ½ç®€å•ä½¿ç”¨çš„æ–°æ‰‹å¼•å¯¼ç»„ä»¶çš„å…¨è¿‡ç¨‹ä»¥åŠæºç äº†,å¯èƒ½ä½¿ç”¨èµ·æ¥ä¸æ˜¯å¾ˆæ–¹ä¾¿,å“ˆå“ˆ,è¿™é‡Œä¸å¾—ä¸ä½©æœé‚£äº›å¼€å‘é€šç”¨ç»„ä»¶çš„å¤§ä½¬,ç¡®å®å¾ˆä¸å®¹æ˜“ğŸ‘ğŸ»ğŸ‘ğŸ»